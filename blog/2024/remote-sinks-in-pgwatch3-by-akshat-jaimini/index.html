<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <p>As a mentor for Google Summer of Code (GSoC) 2024, I am thrilled to witness the innovative ideas and technical expertise that young minds bring to the table. This year, I have the pleasure of working with Akshat Jaimini on an exciting project that aims to enhance PostgreSQL monitoring through the development of <a href="https://summerofcode.withgoogle.com/programs/2024/projects/fA8SxpN7" rel="external nofollow noopener" target="_blank">RPC sinks for pgwatch3</a>. Akshat's work focuses on extending pgwatch3 by developing a mechanism to allow Remote Procedure Call (RPC) sinks, which will offer more flexibility and integration possibilities for users.</p> <p>At this point, I would like to hand over to Akshat, who will delve into the specifics of the project, its goals, and the challenges we aim to address. Akshat, the floor is yours!</p> <hr class="wp-block-separator has-alpha-channel-opacity"> <div class="wp-block-image"> <figure class="alignright"><img decoding="async" width="128" height="128" src="/wp-content/uploads/2024/08/Akshat.png" alt="" class="wp-image-126104" srcset="https://www.cybertec-postgresql.com/wp-content/uploads/2024/08/Akshat.png 128w, https://www.cybertec-postgresql.com/wp-content/uploads/2024/08/Akshat-12x12.png 12w" sizes="(max-width: 128px) 100vw, 128px"></figure> </div> <p></p> <p>Hello! I am Akshat Jaimini, a Computer Engineering Student from India. I was a part of PostgreSQL for the Google Summer of Code 2023 Program where I worked closely with the pgweb development team on developing a testing harness suite for the Official PostgreSQL website. Excited to be a part of the PostgreSQL community!</p> <h2 class="wp-block-heading" id="h-sinks">Sinks?</h2> <p>pgwatch v3 is well under works and with that comes the possibility of new and awesome features that were not there earlier. One such feature is the addition of â€˜Remote Sinksâ€™ in this awesome tool.<br>Sinksâ€¦?</p> <p>Well if you have used pgwatch2 earlier, you would be familiar with the storage concept. Let me get you up to speed.</p> <p>Previously we configured pgwatch in two ways: the Push and the Pull configs. First one will send store measurements somewhere directly, while the pull config allows scrapers to fetch measurements from pgwatch.</p> <p>Regardless of the config being used, essentially all your metric measurements need to be stored somewhere. That particular â€˜storage unitâ€™ is referred to as a Sink in pgwatch v3.</p> <p>So basically pgwatch fetches metric measurements from the â€˜Sourceâ€™ Database and sends/stores them in â€˜Sinksâ€™.</p> <h2 class="wp-block-heading" id="h-why-remote-sinks">Why Remote Sinks?</h2> <p>Till now pgwatch supported PostgreSQL, JSON file and Prometheus as the possible sink solutions. Although these are great for the primary use case but they fall short when these metrics are required for something more.</p> <p>Although these new formats can be added as the feature requests come in, but why keep the capability to ourselves? So we introduced the concept of Remote Sinks which basically provides you with an interface using the go RPC library to get the metrics measurements as a stream of data and utilize them for your respective use cases. This project is a part of Google Summer Of Code, 2024.</p> <p>So the users get an option to write any type of sink without worrying about if pgwatch will be able to integrate with it.</p> <h2 class="wp-block-heading" id="h-architecture">Architecture</h2> <p>As I mentioned earlier, we decided to go with the default RPC library that comes in Go. To visualize this we can refer to the following diagrams:</p> <figure class="wp-block-image size-full"><img decoding="async" width="881" height="537" src="/wp-content/uploads/2024/08/pgwatch-rpc-sinks-architecture.png" alt="" class="wp-image-126099" srcset="https://www.cybertec-postgresql.com/wp-content/uploads/2024/08/pgwatch-rpc-sinks-architecture.png 881w, https://www.cybertec-postgresql.com/wp-content/uploads/2024/08/pgwatch-rpc-sinks-architecture-300x183.png 300w, https://www.cybertec-postgresql.com/wp-content/uploads/2024/08/pgwatch-rpc-sinks-architecture-768x468.png 768w, https://www.cybertec-postgresql.com/wp-content/uploads/2024/08/pgwatch-rpc-sinks-architecture-18x12.png 18w" sizes="(max-width: 881px) 100vw, 881px"></figure> <p>There are some key takeaways from the architecture above:</p> <ul class="wp-block-list"> <li>Remote sinks can be called via a single Remote Procedure Call, therefore no additional processing required.</li> <li>pgwatch does not care about the details of the remote sink at the back.</li> <li>No additional changes required in pgwatch3 setup.</li> </ul> <p>To use your remote sinks you can simply run:</p> <pre class="urvanov-syntax-highlighter-plain-tag">pgwatch --sink=rpc://somehost:42/foo ...</pre> <p>You can try out the development build on <a href="https://github.com/destrex271/pgwatch3_rpc_server" rel="external nofollow noopener" target="_blank">GitHub</a>.</p> <p>As of nowÂ the demo supports the following output formats: CSV and Parquet. And we plan on adding more examples for our users but that's a surprise weâ€™ll like to keep for <a href="https://www.postgresql.eu/events/pgconfeu2024/schedule/session/5647-gsoc-2024-enhancing-data-insights-for-postgres-with-remote-sinks/" rel="external nofollow noopener" target="_blank">pgconf.eu 2024</a> ðŸ˜‰</p> <h2 class="wp-block-heading" id="h-how-can-i-develop-my-own-sinks">How can I develop my own sinks?</h2> <p>To develop your own sinks you can follow the given steps.</p> <p>Clone the repository from https://github.com/destrex271/pgwatch3_rpc_server</p> <p>In the sinks folder create a new file with whatever sink format name you want and declare an enum for your sink in the <span id="urvanov-syntax-highlighter-67a749ba581e5450720866" class="urvanov-syntax-highlighter-syntax urvanov-syntax-highlighter-syntax-inline crayon-theme-vs2012-copy crayon-theme-vs2012-copy-inline urvanov-syntax-highlighter-font-sourcecodepro" style="font-size: 14px !important; line-height: 16px !important;font-size: 14px !important;"><span class="crayon-pre urvanov-syntax-highlighter-code" style="font-size: 14px !important; line-height: 16px !important;font-size: 14px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">sink<span class="crayon-o">/</span>types.go</span></span>Â  file. Also donâ€™t forget to update the conditionals! (Weâ€™ll end up changing this so that it automatically prepares calls according to the enums in the future)</p> <p>With this your setup is complete!</p> <p>PS: You can raise a PR if you feel that these sinks can be used by other people too!</p> <p>While developing your sinks you can use the <span id="urvanov-syntax-highlighter-67a749ba581e6187451027" class="urvanov-syntax-highlighter-syntax urvanov-syntax-highlighter-syntax-inline crayon-theme-vs2012-copy crayon-theme-vs2012-copy-inline urvanov-syntax-highlighter-font-sourcecodepro" style="font-size: 14px !important; line-height: 16px !important;font-size: 14px !important;"><span class="crayon-pre urvanov-syntax-highlighter-code" style="font-size: 14px !important; line-height: 16px !important;font-size: 14px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">primary_receiver</span></span>Â  instance passed into the <span id="urvanov-syntax-highlighter-67a749ba581e7413997461" class="urvanov-syntax-highlighter-syntax urvanov-syntax-highlighter-syntax-inline crayon-theme-vs2012-copy crayon-theme-vs2012-copy-inline urvanov-syntax-highlighter-font-sourcecodepro" style="font-size: 14px !important; line-height: 16px !important;font-size: 14px !important;"><span class="crayon-pre urvanov-syntax-highlighter-code" style="font-size: 14px !important; line-height: 16px !important;font-size: 14px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">UpdateMeasurement()</span></span>Â  function of your sink for the following:</p> <ul class="wp-block-list"> <li>Retrieving Meta parameters associated with the Remote Procedure Call.</li> <li>Receiving Sync Metric Signals(Like â€˜DELETE monitored databaseâ€™, â€˜ADD new metricâ€™, etcâ€¦) if you want to support them in your sinks.</li> </ul> <h2 class="wp-block-heading" id="h-how-do-i-test-my-sink">How do I test my sink?</h2> <p>Worry not, I have a dummy client written within the repository which you can use to generate requests for your newly developed sink. It is there to simulate pgwatch3 without actually launching an instance.<br>Road Ahead!</p> <p>The development on this part of pgwatch3 is in full swing and we hope to soon make it as easily accessible for all our beloved users!</p> <p>Also if you wish to contribute letâ€™s meet in the <a href="https://github.com/destrex271/pgwatch3_rpc_server/issues" rel="external nofollow noopener" target="_blank">discussions/issues section of the project.</a></p> <p>Thanks for reading!</p> <p><strong>In order to receive regular updates on important changes in PostgreSQL,Â <a href="/en/newsletter/" target="_blank" rel="noreferrer noopener">subscribe to our newsletter</a>, or follow us onÂ <a href="https://www.facebook.com/cybertec.postgresql" target="_blank" rel="noreferrer noopener">Facebook</a>Â orÂ <a href="https://at.linkedin.com/company/cybertec-postgresql" target="_blank" rel="noreferrer noopener">LinkedIn</a>.</strong></p> <p>The post <a href="https://www.cybertec-postgresql.com/en/remote-sinks-in-pgwatch3-by-akshat-jaimini/" rel="external nofollow noopener" target="_blank">Remote Sinks in pgwatch3 by Akshat Jaimini</a> appeared first on <a href="https://www.cybertec-postgresql.com/en" rel="external nofollow noopener" target="_blank">CYBERTEC PostgreSQL | Services &amp; Support</a>.</p> </body></html>