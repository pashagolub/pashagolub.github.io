<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"> <html><body> <h2 class="wp-block-heading" id="h-introduction">Introduction</h2> <p>Recently, we had a long discussion in our internal chat about the concept of <strong>Trusted Extensions</strong> in PostgreSQL. It became clear that while the feature is very useful, it’s often misunderstood — especially by beginners. Let's fix that!</p> <p>This post explains <strong>what trusted extensions are</strong>, <strong>why they exist</strong>, <strong>how they work</strong>, and provides some <strong>important hints and warnings</strong> for everyday use.</p> <h2 class="wp-block-heading" id="h-what-are-postgresql-extensions">What Are PostgreSQL Extensions?</h2> <p>An <strong>extension</strong> is a package of SQL scripts, types, functions, and sometimes even compiled C code that extends PostgreSQL's capabilities.<br>Extensions are installed on the server and then enabled inside a database using:</p> <pre class="urvanov-syntax-highlighter-plain-tag">CREATE EXTENSION my_extension;</pre> <p>Normally, installing or enabling an extension requires <strong>superuser privileges</strong>, because extensions can modify how the database server behaves.</p> <h2 class="wp-block-heading">What Does "Trusted" Mean?</h2> <p><strong>Trusted extensions</strong> allow <strong>non-superusers</strong> (regular database users) to enable certain extensions themselves using <code>CREATE EXTENSION</code>, without needing superuser rights.</p> <p>In simple words:</p> <ul class="wp-block-list"> <li>If an extension is <strong>trusted</strong>, a user with <code>CREATE</code> privilege on a database can activate it.</li> <li>If an extension is <strong>not trusted</strong>, only a superuser can activate it.</li> </ul> <p><strong>Important:</strong><br><em>"Trusted"</em> <strong>does not mean</strong>:</p> <ul class="wp-block-list"> <li>The extension is bug-free.</li> <li>The code has been officially audited by PostgreSQL core developers.</li> <li>It is completely safe in every possible scenario.</li> </ul> <p>It simply means:</p> <blockquote class="wp-block-quote is-layout-flow wp-block-quote-is-layout-flow"> <p><em>"We believe that enabling this extension should not allow users to bypass security or harm the database server."</em></p> </blockquote> <h2 class="wp-block-heading">How Does PostgreSQL Know if an Extension is Trusted?</h2> <p>Each extension has a <strong>control file</strong> (<code>.control</code>) where its properties are described.<br>Inside that file, the line:</p> <pre class="urvanov-syntax-highlighter-plain-tag">trusted = true</pre> <p>tells <a href="https://www.postgresql.org/" rel="external nofollow noopener" target="_blank">PostgreSQL </a>that the extension can be enabled by non-superusers.</p> <p>If the line is missing, the extension is considered <strong>untrusted</strong> by default.</p> <p><strong>Example of a simple control file:</strong></p> <pre class="urvanov-syntax-highlighter-plain-tag">comment = 'Extension for text search'
default_version = '1.0'
relocatable = false
superuser = false
trusted = true</pre> <p>The same extension can be trusted on one server but untrusted on another, depending on what the local superuser decides!</p> <h2 class="wp-block-heading">Why Is Trusted Important for Cloud Providers?</h2> <p>Trusted extensions are especially <strong>important for PostgreSQL cloud providers</strong>. In managed database services), users typically <strong>don't have superuser access</strong> for safety reasons. Without trusted extensions, they would be severely limited in extending the functionality of their databases.</p> <p>Thanks to trusted extensions:</p> <ul class="wp-block-list"> <li>Users can self-service common tools like <code>hstore</code>, <code>citext</code>, <code>pg_trgm</code>, and more.</li> <li>Cloud providers can offer flexibility without compromising security.</li> <li>Managing thousands of customer databases becomes much easier!</li> </ul> <p>As you can see, <strong>trusted extensions make PostgreSQL much more cloud-friendly!</strong></p> <h2 class="wp-block-heading">Trusted = Toy Room Analogy</h2> <p>Let's use a simple analogy:<br>Imagine a <strong>kindergarten</strong> (your PostgreSQL server) full of <strong>kids</strong> (database users) who love to play with <strong>toys</strong> (extensions). You, as the <strong>principal/teacher</strong> (superuser), are responsible for making sure everyone is safe.</p> <ul class="wp-block-list"> <li>There are <strong>two rooms</strong> with toys: <ul class="wp-block-list"> <li>An <strong>open room</strong>: All kids can freely play here.</li> <li>A <strong>locked room</strong>: Only staff can bring out toys under supervision.</li> </ul> </li> </ul> <p>You decide which toys go into which room:</p> <ul class="wp-block-list"> <li> <strong>A soft ball</strong> is safe → It goes into the <strong>open room</strong> (trusted).</li> <li> <strong>Lego pieces</strong> might be dangerous for very young kids → They stay in the <strong>locked room</strong> (untrusted).</li> <li> <strong>Toy guns or slingshots</strong> are risky → Definitely kept locked.</li> </ul> <p>The important thing is it’s not about <em>who</em> made the toy (extension author), or even how famous it is.<br>It’s about whether it’s <em>safe to allow general users</em> to play with it without direct supervision.</p> <p>And yes — if a principal (admin) wants, they could technically move any toy to the open room — but it's on them if something goes wrong!</p> <h2 class="wp-block-heading">Why PostgreSQL Core Marks Some Extensions as Trusted</h2> <p>Some extensions that ship bundled with PostgreSQL (from the "contrib" modules) are marked trusted.<br>These usually provide <strong>safe</strong> functionality like new data types, functions, or indexes without dangerous side effects.</p> <p>However, <strong>external extensions</strong> (e.g., developed by companies like CYBERTEC) are not usually automatically trusted — it's up to authors and administrators to make those decisions.</p> <h2 class="wp-block-heading">Important Hints, Warnings, and Notes</h2> <p>- <strong>Trusted does not mean bug-free.</strong><br>Even trusted extensions could have bugs. Trust is a <em>promise</em> by the author — not a full audit!</p> <p>- <strong>C Extensions deserve extra caution.</strong><br>If an extension loads C code (.so files), it can still crash the database or introduce risks. Labeling them trusted requires careful review. Same applies for pgrx extension written in Rust, for example.</p> <p>- <strong>Superusers have the final say.</strong><br>Admins can override trust by editing control files or managing access rights manually.</p> <p>- <strong>"Install" vs "Create" confusion.</strong></p> <ul class="wp-block-list"> <li> <strong>Installing</strong> an extension = Copying files to the server.</li> <li> <strong>Creating</strong> an extension = Registering it in a specific database with SQL.</li> </ul> <p>- <strong>You don't have to trust blindly.</strong><br>Even if an extension says "trusted", it's perfectly okay to review it yourself before allowing users to enable it.</p> <h2 class="wp-block-heading">Final Thoughts</h2> <p>Trusted extensions are an elegant PostgreSQL feature that helps <strong>balance security and flexibility</strong>.</p> <ul class="wp-block-list"> <li>If you <strong>develop extensions</strong>, think carefully before marking them trusted.</li> <li>If you <strong>administer servers</strong>, regularly review what you allow users to install.</li> <li>If you <strong>use PostgreSQL in the cloud</strong>, appreciate how trusted extensions help you extend your database easily!</li> </ul> <p>Used wisely, trusted extensions empower PostgreSQL to stay open, safe, and powerful for everyone.</p> <p>The post <a href="https://www.cybertec-postgresql.com/en/postgresql-trusted-extensions-for-beginners/" rel="external nofollow noopener" target="_blank">PostgreSQL Trusted Extensions for Beginners</a> appeared first on <a href="https://www.cybertec-postgresql.com/en" rel="external nofollow noopener" target="_blank">CYBERTEC PostgreSQL | Services &amp; Support</a>.</p> </body></html>